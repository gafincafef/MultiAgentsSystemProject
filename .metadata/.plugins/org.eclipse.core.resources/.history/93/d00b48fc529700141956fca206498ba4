package edu.rits.ma.jade.impl;

import jade.core.Profile;
import jade.util.leap.Properties;
import jade.wrapper.ControllerException;
import jade.wrapper.gateway.JadeGateway;

import java.util.List;

import edu.rits.ma.common.IAgentGateway;
import edu.rits.ma.common.ITask;

public class PrimaryAgentGatewayImpl implements IAgentGateway {

	private String mHost;
	private String mPort;
	private String mPrimaryAgentClassName;
	private String mSecondaryAgentClassName;

	public PrimaryAgentGatewayImpl(String host, String port, String primaryAgentClassName, String secondaryAgentClassName) {
		mHost = host;
		mPort = port;
		mPrimaryAgentClassName = primaryAgentClassName;
		mSecondaryAgentClassName = secondaryAgentClassName;
	}

	@Override
	public void prepareAgents(int numberOfAgents) {
		Properties pp = new Properties();
		pp.setProperty(Profile.MAIN_HOST, mHost);
		pp.setProperty(Profile.MAIN_PORT, mPort);
		JadeGateway.init(mPrimaryAgentClassName, new Object[] {numberOfAgents - 1, mSecondaryAgentClassName}, pp);
	}

	@Override
	public void runTasksOnAgents(List<ITask> tasks) {
		try {
			if(tasks != null) {
				JadeGateway.execute(tasks); 
			}
		}
		catch (ControllerException | InterruptedException e) {
			e.printStackTrace();
		}
		finally {
			JadeGateway.shutdown();
		}
	}

}
